<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî± –î–Ω–µ–≤–Ω–∏–∫ –ü–æ–ª—É–±–æ–≥–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            min-height: 100vh;
            padding: 20px;
            color: #f0f9ff;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            color: #bfdbfe;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: 2px solid #fff;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .mode-switcher {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #fff;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #fff;
            color: #1e3a8a;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .mode-btn.active:hover {
            background: #fff;
        }

        .card {
            background: rgba(30, 58, 138, 0.8);
            border: 2px solid #60a5fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-header {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #fff;
            font-size: 14px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #60a5fa;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #1e3a8a;
            font-size: 14px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #93c5fd;
            background: #fff;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-label:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #60a5fa;
            color: #1e3a8a;
        }

        .btn-primary:hover {
            background: #93c5fd;
        }

        .btn-success {
            background: #10b981;
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .support-message {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            animation: fadeIn 0.5s;
            border: 2px solid #93c5fd;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .support-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .support-text {
            font-size: 18px;
            font-weight: bold;
        }

        .daily-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-btn {
            padding: 20px;
            border: 2px solid #60a5fa;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .status-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .status-btn.selected {
            background: #60a5fa;
            border-color: #93c5fd;
        }

        .status-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .status-label {
            font-size: 14px;
            font-weight: bold;
        }

        .medicine-counter {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .medicine-name {
            flex: 1;
            font-weight: bold;
        }

        .counter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .counter-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: #60a5fa;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .counter-btn:hover {
            background: #93c5fd;
        }

        .counter-value {
            font-size: 24px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #60a5fa;
        }

        .history-date {
            font-weight: bold;
            color: #93c5fd;
            margin-bottom: 8px;
        }

        .history-detail {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .severity-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .severity-light {
            background: #10b981;
            color: white;
        }

        .severity-medium {
            background: #f59e0b;
            color: white;
        }

        .severity-heavy {
            background: #dc2626;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #93c5fd;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #bfdbfe;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #bfdbfe;
        }

        .no-data-icon {
            font-size: 64px;
            margin-bottom: 15px;
        }

        @media (max-width: 600px) {
            .daily-status {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Ñ–∏–ª—é</a>

        <div class="header">
            <div class="title">üî± –î–ù–ï–í–ù–ò–ö –ü–û–õ–£–ë–û–ì–ê üî±</div>
            <div class="subtitle">–õ–∞–≥–µ—Ä—å –ü–æ–ª—É–∫—Ä–æ–≤–æ–∫ - –ñ—É—Ä–Ω–∞–ª –¢–æ—à–∫–∏</div>
        </div>

        <div class="mode-switcher">
            <button class="mode-btn" onclick="switchMode('mama')">üë©‚Äç‚öïÔ∏è –î–ª—è –º–∞–º—ã</button>
            <button class="mode-btn active" onclick="switchMode('toshka')">üßô‚Äç‚ôÇÔ∏è –î–ª—è –¢–æ—à–∫–∏</button>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –î–õ–Ø –¢–û–®–ö–ò -->
        <section id="toshkaSection" class="section active">
            <div id="supportMessageContainer"></div>

            <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞ -->
            <div class="card">
                <div class="section-header">
                    <span>üòÆ‚Äçüí®</span>
                    <span>–ö–∞–∫ –¥—ã—à–∏—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è?</span>
                </div>

                <div class="daily-status">
                    <div class="status-btn" onclick="setDailyStatus('excellent')">
                        <div class="status-icon">üòä</div>
                        <div class="status-label">–û—Ç–ª–∏—á–Ω–æ!</div>
                    </div>
                    <div class="status-btn" onclick="setDailyStatus('good')">
                        <div class="status-icon">üôÇ</div>
                        <div class="status-label">–ù–æ—Ä–º–∞–ª—å–Ω–æ</div>
                    </div>
                    <div class="status-btn" onclick="setDailyStatus('difficult')">
                        <div class="status-icon">üòê</div>
                        <div class="status-label">–ó–∞—Ç—Ä—É–¥–Ω—ë–Ω–Ω–æ</div>
                    </div>
                    <div class="status-btn" onclick="setDailyStatus('bad')">
                        <div class="status-icon">üòü</div>
                        <div class="status-label">–ü–ª–æ—Ö–æ</div>
                    </div>
                </div>

                <div id="dailyStatusMessage" style="text-align: center; margin-top: 15px; font-size: 14px;"></div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏—Å—Ç—É–ø–∞ -->
            <div class="card" style="text-align: center;">
                <button class="btn btn-danger" style="width: 100%; padding: 20px; font-size: 18px;" onclick="showAttackForm()">
                    ‚ö†Ô∏è –ù–ê–ß–ê–õ–°–Ø –ü–†–ò–°–¢–£–ü - –ó–ê–ü–ò–°–ê–¢–¨ –ë–ò–¢–í–£
                </button>
            </div>

            <!-- –§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏—Å—Ç—É–ø–∞ -->
            <div class="card" id="attackFormCard" style="display: none;">
                <div class="section-header">
                    <span>‚öîÔ∏è</span>
                    <span>–ó–∞–ø–∏—Å—å –±–∏—Ç–≤—ã —Å –º–æ–Ω—Å—Ç—Ä–æ–º</span>
                </div>

                <form id="attackForm" onsubmit="saveAttack(event)">
                    <div class="form-group">
                        <label class="form-label">üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</label>
                        <input type="datetime-local" id="attackDateTime" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üå™Ô∏è –ß—Ç–æ —Ä–∞–∑–±—É–¥–∏–ª–æ –º–æ–Ω—Å—Ç—Ä–∞?</label>
                        <div class="checkbox-group" id="triggersList"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üò§ –°–∏–º–ø—Ç–æ–º—ã –±–∏—Ç–≤—ã:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="symptom" value="–û–¥—ã—à–∫–∞">
                                <span>üí® –û–¥—ã—à–∫–∞ (—Ç—è–∂–µ–ª–æ –¥—ã—à–∞—Ç—å)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="symptom" value="–•—Ä–∏–ø—ã">
                                <span>üéµ –•—Ä–∏–ø—ã (—Å–≤–∏—Å—Ç –ø—Ä–∏ –¥—ã—Ö–∞–Ω–∏–∏)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="symptom" value="–ö–∞—à–µ–ª—å">
                                <span>üò∑ –ö–∞—à–µ–ª—å</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="symptom" value="–¢—è–∂–µ—Å—Ç—å –≤ –≥—Ä—É–¥–∏">
                                <span>ü´Å –¢—è–∂–µ—Å—Ç—å –≤ –≥—Ä—É–¥–∏</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìä –ù–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã–π –º–æ–Ω—Å—Ç—Ä?</label>
                        <select id="severity" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏...</option>
                            <option value="light">üü¢ –ú–∞–ª–µ–Ω—å–∫–∏–π (–ª–µ–≥–∫–∏–π –ø—Ä–∏—Å—Ç—É–ø)</option>
                            <option value="medium">üü° –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="heavy">üî¥ –ë–æ–ª—å—à–æ–π (—Ç—è–∂–µ–ª—ã–π –ø—Ä–∏—Å—Ç—É–ø)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚öîÔ∏è –ö–∞–∫–æ–µ –æ—Ä—É–∂–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª:</label>
                        
                        <div class="medicine-counter">
                            <div class="medicine-name">üí® –°–∞–ª—å–±—É—Ç–∞–º–æ–ª (–±—ã—Å—Ç—Ä–æ–µ –æ—Ä—É–∂–∏–µ):</div>
                            <div class="counter-controls">
                                <button type="button" class="counter-btn" onclick="changeMedicineCount('salbutamol', -1)">‚àí</button>
                                <div class="counter-value" id="salbutamolCount">0</div>
                                <button type="button" class="counter-btn" onclick="changeMedicineCount('salbutamol', 1)">+</button>
                            </div>
                        </div>

                        <div class="medicine-counter">
                            <div class="medicine-name">üí® –ë—É–¥–µ—Å–æ–Ω–∏–¥ (–±–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞):</div>
                            <div class="counter-controls">
                                <button type="button" class="counter-btn" onclick="changeMedicineCount('budesonide', -1)">‚àí</button>
                                <div class="counter-value" id="budesonideCount">0</div>
                                <button type="button" class="counter-btn" onclick="changeMedicineCount('budesonide', 1)">+</button>
                            </div>
                        </div>

                        <label class="checkbox-label">
                            <input type="checkbox" id="prednisolone">
                            <span>üíä –ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω (–º–æ—â–Ω–æ–µ –∑–µ–ª—å–µ)</span>
                        </label>

                        <label class="checkbox-label">
                            <input type="checkbox" id="hydrocortisone">
                            <span>üíâ –ì–∏–¥—Ä–æ–∫–æ—Ä—Ç–∏–∑–æ–Ω (—É–∫–æ–ª –≤ –±–æ–ª—å–Ω–∏—Ü–µ)</span>
                        </label>

                        <div class="form-group" style="margin-top: 15px;">
                            <label class="form-label">–î—Ä—É–≥–æ–µ –æ—Ä—É–∂–∏–µ:</label>
                            <input type="text" id="otherMedicine" class="form-input" placeholder="–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —á—Ç–æ-—Ç–æ –µ—â–µ">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚è∞ –ß–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç —Å—Ç–∞–ª–æ –ª–µ–≥—á–µ?</label>
                        <input type="number" id="recoveryTime" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15" min="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">üòå –ù–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥—á–µ —Å—Ç–∞–ª–æ?</label>
                        <select id="improvement" class="form-select">
                            <option value="">–í—ã–±–µ—Ä–∏...</option>
                            <option value="fully">‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—à–ª–æ</option>
                            <option value="much">üòä –ù–∞–º–Ω–æ–≥–æ –ª–µ–≥—á–µ</option>
                            <option value="little">üôÇ –ù–µ–º–Ω–æ–≥–æ –ª–µ–≥—á–µ</option>
                            <option value="none">üòê –ù–µ –ø–æ–º–æ–≥–ª–æ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—á—Ç–æ –µ—â–µ –≤–∞–∂–Ω–æ):</label>
                        <textarea id="comments" class="form-textarea" placeholder="–û–ø–∏—à–∏ –±–∏—Ç–≤—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –±–∏—Ç–≤–µ</button>
                    <button type="button" class="btn" style="width: 100%; margin-top: 10px; background: #6b7280; color: white;" onclick="cancelAttackForm()">–û—Ç–º–µ–Ω–∞</button>
                </form>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π -->
            <div class="card" id="recentHistory">
                <div class="section-header">
                    <span>üìú</span>
                    <span>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –±–∏—Ç–≤—ã</span>
                </div>
                <div id="recentHistoryList"></div>
            </div>
        </section>

        <!-- –°–ï–ö–¶–ò–Ø –î–õ–Ø –ú–ê–ú–´ -->
        <section id="mamaSection" class="section">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="card">
                <div class="section-header">
                    <span>üìä</span>
                    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                </div>
                <div class="stats-grid" id="statsGrid"></div>
            </div>

            <!-- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π -->
            <div class="card">
                <div class="section-header">
                    <span>üìñ</span>
                    <span>–í—Å–µ –∑–∞–ø–∏—Å–∏</span>
                </div>
                <div id="allHistoryList"></div>
                
                <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="downloadReport()">
                    üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç –¥–ª—è –≤—Ä–∞—á–∞
                </button>
            </div>
        </section>
    </div>

    <script>
        let medicineCounts = {
            salbutamol: 0,
            budesonide: 0
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.addEventListener('DOMContentLoaded', function() {
            loadTriggers();
            loadDailyStatus();
            loadRecentHistory();
            document.getElementById('attackDateTime').value = getCurrentDateTime();
        });

        // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
        function getCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            if (mode === 'mama') {
                document.getElementById('mamaSection').classList.add('active');
                displayStats();
                displayAllHistory();
            } else {
                document.getElementById('toshkaSection').classList.add('active');
                loadRecentHistory();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
        function loadTriggers() {
            const triggers = JSON.parse(localStorage.getItem('toshkaTriggers') || '["‚ùÑÔ∏è –•–æ–ª–æ–¥", "üëÉ –†–µ–∑–∫–∏–µ –∑–∞–ø–∞—Ö–∏ (–≤–∞–∑–µ–ª–∏–Ω, –º–∞—Å–ª–∞, –ø–∞—Ä—Ñ—é–º)"]');
            const container = document.getElementById('triggersList');
            
            container.innerHTML = triggers.map((trigger, index) => `
                <label class="checkbox-label">
                    <input type="checkbox" name="trigger" value="${trigger}">
                    <span>${trigger}</span>
                </label>
            `).join('') + `
                <label class="checkbox-label">
                    <input type="checkbox" name="trigger" value="–ù–µ –∑–Ω–∞—é">
                    <span>‚ùì –ù–µ –∑–Ω–∞—é</span>
                </label>
            `;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        function setDailyStatus(status) {
            const today = new Date().toISOString().split('T')[0];
            const dailyRecords = JSON.parse(localStorage.getItem('toshkaDailyStatus') || '{}');
            
            dailyRecords[today] = {
                status: status,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('toshkaDailyStatus', JSON.stringify(dailyRecords));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
            showSupportMessage(status);
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            loadDailyStatus();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
        function loadDailyStatus() {
            const today = new Date().toISOString().split('T')[0];
            const dailyRecords = JSON.parse(localStorage.getItem('toshkaDailyStatus') || '{}');
            const todayStatus = dailyRecords[today];
            
            // –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.status-btn').forEach(btn => btn.classList.remove('selected'));
            
            if (todayStatus) {
                // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
                const buttons = document.querySelectorAll('.status-btn');
                const statusMap = ['excellent', 'good', 'difficult', 'bad'];
                const index = statusMap.indexOf(todayStatus.status);
                if (index !== -1 && buttons[index]) {
                    buttons[index].classList.add('selected');
                }
                
                document.getElementById('dailyStatusMessage').textContent = '‚úÖ –û—Ç–º–µ—á–µ–Ω–æ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è';
            } else {
                document.getElementById('dailyStatusMessage').textContent = '';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
        function showSupportMessage(status) {
            const messages = {
                excellent: ['üåä –ú–æ—Ä–µ —Å–ø–æ–∫–æ–π–Ω–æ! –ü–æ—Å–µ–π–¥–æ–Ω —Å —Ç–æ–±–æ–π!', '‚ö° –î—ã—à–∏ —Å–≤–æ–±–æ–¥–Ω–æ, —Å—ã–Ω –ü–æ—Å–µ–π–¥–æ–Ω–∞!', 'üî± –°–∏–ª–∞ –û–ª–∏–º–ø–∞ —Ç–µ—á—ë—Ç –≤ —Ç–µ–±–µ!'],
                good: ['üí™ –•–æ—Ä–æ—à–æ –¥–µ—Ä–∂–∏—à—å—Å—è! –û–ª–∏–º–ø –≥–æ—Ä–¥–∏—Ç—Å—è!', 'üåä –ú–æ—Ä–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–±—è!', '‚ö° –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å, –ø–æ–ª—É–±–æ–≥!'],
                difficult: ['üó°Ô∏è –î–µ—Ä–∂–∏—Å—å! –ë–æ–≥–∏ –û–ª–∏–º–ø–∞ —Å —Ç–æ–±–æ–π!', 'üõ°Ô∏è –ü–æ—Å–µ–π–¥–æ–Ω –ø–æ–º–æ–∂–µ—Ç! –î—ã—à–∏ –≥–ª—É–±–∂–µ!', 'üí™ –ü–æ–ª—É–±–æ–≥–∏ –Ω–µ —Å–¥–∞—é—Ç—Å—è! –î–µ—Ä–∏—Å—å!'],
                bad: ['üî• –ü–æ—Å–µ–π–¥–æ–Ω –Ω–µ –æ—Å—Ç–∞–≤–∏—Ç —Ç–µ–±—è! –î–µ—Ä–∂–∏—Å—å!', 'üèõÔ∏è –û–ª–∏–º–ø –Ω–∞ —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ! –ë–æ—Ä–∏—Å—å!', 'üíô –î—ã—à–∏! –ë–æ–≥–∏ —Å —Ç–æ–±–æ–π! –¢—ã —Å–∏–ª—å–Ω—ã–π!']
            };
            
            const messageArray = messages[status] || messages.good;
            const message = messageArray[Math.floor(Math.random() * messageArray.length)];
            
            const container = document.getElementById('supportMessageContainer');
            const icon = status === 'excellent' || status === 'good' ? 'üî±' : '‚öîÔ∏è';
            
            container.innerHTML = `
                <div class="support-message">
                    <div class="support-icon">${icon}</div>
                    <div class="support-text">${message}</div>
                </div>
            `;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –ø—Ä–∏—Å—Ç—É–ø–∞
        function showAttackForm() {
            document.getElementById('attackFormCard').style.display = 'block';
            document.getElementById('attackFormCard').scrollIntoView({ behavior: 'smooth' });
        }

        // –û—Ç–º–µ–Ω–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏—Å—Ç—É–ø–∞
        function cancelAttackForm() {
            document.getElementById('attackFormCard').style.display = 'none';
            document.getElementById('attackForm').reset();
            medicineCounts = { salbutamol: 0, budesonide: 0 };
            updateMedicineCounts();
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤
        function changeMedicineCount(medicine, delta) {
            medicineCounts[medicine] = Math.max(0, medicineCounts[medicine] + delta);
            updateMedicineCounts();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–æ–≤
        function updateMedicineCounts() {
            document.getElementById('salbutamolCount').textContent = medicineCounts.salbutamol;
            document.getElementById('budesonideCount').textContent = medicineCounts.budesonide;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏—Å—Ç—É–ø–∞
        function saveAttack(event) {
            event.preventDefault();
            
            const triggers = Array.from(document.querySelectorAll('input[name="trigger"]:checked')).map(cb => cb.value);
            const symptoms = Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(cb => cb.value);
            
            const attack = {
                dateTime: document.getElementById('attackDateTime').value,
                triggers: triggers,
                symptoms: symptoms,
                severity: document.getElementById('severity').value,
                medicines: {
                    salbutamol: medicineCounts.salbutamol,
                    budesonide: medicineCounts.budesonide,
                    prednisolone: document.getElementById('prednisolone').checked,
                    hydrocortisone: document.getElementById('hydrocortisone').checked,
                    other: document.getElementById('otherMedicine').value
                },
                recoveryTime: document.getElementById('recoveryTime').value,
                improvement: document.getElementById('improvement').value,
                comments: document.getElementById('comments').value,
                timestamp: new Date().toISOString()
            };
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é
            const history = JSON.parse(localStorage.getItem('toshkaAsthmaHistory') || '[]');
            history.push(attack);
            localStorage.setItem('toshkaAsthmaHistory', JSON.stringify(history));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É
            const severity = attack.severity;
            if (severity === 'light') {
                showSupportAfterAttack('üó°Ô∏è –¢—ã —Å–ø—Ä–∞–≤–∏–ª—Å—è! –ù–∞—Å—Ç–æ—è—â–∏–π –≥–µ—Ä–æ–π –û–ª–∏–º–ø–∞!');
            } else if (severity === 'medium') {
                showSupportAfterAttack('üõ°Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –æ—Ä—É–∂–∏–µ –≤–æ–≤—Ä–µ–º—è - —ç—Ç–æ –º—É–¥—Ä–æ!');
            } else {
                showSupportAfterAttack('üî• –¢—ã —Å—Ä–∞–∂–∞–ª—Å—è –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–æ–ª—É–±–æ–≥! –ì–æ—Ä–¥–∏–º—Å—è —Ç–æ–±–æ–π!');
            }
            
            alert('‚úÖ –ë–∏—Ç–≤–∞ –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫!');
            cancelAttackForm();
            loadRecentHistory();
        }

        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏—Å—Ç—É–ø–∞
        function showSupportAfterAttack(message) {
            const container = document.getElementById('supportMessageContainer');
            container.innerHTML = `
                <div class="support-message">
                    <div class="support-icon">üèõÔ∏è</div>
                    <div class="support-text">${message}<br><small>üìú –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∂—É—Ä–Ω–∞–ª –ø–æ–ª—É–±–æ–≥–∞</small></div>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
        function loadRecentHistory() {
            const history = JSON.parse(localStorage.getItem('toshkaAsthmaHistory') || '[]');
            const container = document.getElementById('recentHistoryList');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="no-data"><div class="no-data-icon">üìú</div><p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –±–∏—Ç–≤–∞—Ö</p></div>';
                return;
            }
            
            const recent = history.slice(-5).reverse();
            container.innerHTML = recent.map(attack => formatHistoryItem(attack)).join('');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
        function formatHistoryItem(attack) {
            const date = new Date(attack.dateTime);
            const dateStr = date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
            
            const severityClass = attack.severity === 'light' ? 'severity-light' : attack.severity === 'medium' ? 'severity-medium' : 'severity-heavy';
            const severityText = attack.severity === 'light' ? '–õ–µ–≥–∫–∏–π' : attack.severity === 'medium' ? '–°—Ä–µ–¥–Ω–∏–π' : '–¢—è–∂–µ–ª—ã–π';
            
            let medicinesUsed = [];
            if (attack.medicines.salbutamol > 0) medicinesUsed.push(`–°–∞–ª—å–±—É—Ç–∞–º–æ–ª ${attack.medicines.salbutamol}√ó`);
            if (attack.medicines.budesonide > 0) medicinesUsed.push(`–ë—É–¥–µ—Å–æ–Ω–∏–¥ ${attack.medicines.budesonide}√ó`);
            if (attack.medicines.prednisolone) medicinesUsed.push('–ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω');
            if (attack.medicines.hydrocortisone) medicinesUsed.push('–ì–∏–¥—Ä–æ–∫–æ—Ä—Ç–∏–∑–æ–Ω');
            if (attack.medicines.other) medicinesUsed.push(attack.medicines.other);
            
            return `
                <div class="history-item">
                    <div class="history-date">${dateStr} <span class="severity-indicator ${severityClass}">${severityText}</span></div>
                    <div class="history-detail"><strong>–¢—Ä–∏–≥–≥–µ—Ä—ã:</strong> ${attack.triggers.join(', ') || '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}</div>
                    <div class="history-detail"><strong>–°–∏–º–ø—Ç–æ–º—ã:</strong> ${attack.symptoms.join(', ') || '–ù–µ —É–∫–∞–∑–∞–Ω—ã'}</div>
                    <div class="history-detail"><strong>–õ–µ—á–µ–Ω–∏–µ:</strong> ${medicinesUsed.join(', ') || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                    ${attack.recoveryTime ? `<div class="history-detail"><strong>–°—Ç–∞–ª–æ –ª–µ–≥—á–µ —á–µ—Ä–µ–∑:</strong> ${attack.recoveryTime} –º–∏–Ω</div>` : ''}
                    ${attack.comments ? `<div class="history-detail"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</strong> ${attack.comments}</div>` : ''}
                </div>
            `;
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function displayStats() {
            const history = JSON.parse(localStorage.getItem('toshkaAsthmaHistory') || '[]');
            const container = document.getElementById('statsGrid');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="no-data" style="grid-column: 1/-1;"><p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p></div>';
                return;
            }
            
            const totalAttacks = history.length;
            const lightAttacks = history.filter(a => a.severity === 'light').length;
            const mediumAttacks = history.filter(a => a.severity === 'medium').length;
            const heavyAttacks = history.filter(a => a.severity === 'heavy').length;
            
            // –°–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
            const triggerCounts = {};
            history.forEach(attack => {
                attack.triggers.forEach(trigger => {
                    triggerCounts[trigger] = (triggerCounts[trigger] || 0) + 1;
                });
            });
            const topTrigger = Object.keys(triggerCounts).sort((a, b) => triggerCounts[b] - triggerCounts[a])[0] || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            
            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalAttacks}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${lightAttacks}</div>
                    <div class="stat-label">–õ–µ–≥–∫–∏—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${mediumAttacks}</div>
                    <div class="stat-label">–°—Ä–µ–¥–Ω–∏—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${heavyAttacks}</div>
                    <div class="stat-label">–¢—è–∂–µ–ª—ã—Ö</div>
                </div>
                <div class="stat-card" style="grid-column: 1/-1;">
                    <div class="stat-label">–°–∞–º—ã–π —á–∞—Å—Ç—ã–π —Ç—Ä–∏–≥–≥–µ—Ä</div>
                    <div class="stat-value" style="font-size: 18px; margin-top: 10px;">${topTrigger}</div>
                </div>
            `;
        }

        // –í—Å—è –∏—Å—Ç–æ—Ä–∏—è
        function displayAllHistory() {
            const history = JSON.parse(localStorage.getItem('toshkaAsthmaHistory') || '[]');
            const container = document.getElementById('allHistoryList');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="no-data"><div class="no-data-icon">üìñ</div><p>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</p></div>';
                return;
            }
            
            const reversed = [...history].reverse();
            container.innerHTML = reversed.map(attack => formatHistoryItem(attack)).join('');
        }

        // –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
        function downloadReport() {
            const history = JSON.parse(localStorage.getItem('toshkaAsthmaHistory') || '[]');
            const dailyStatus = JSON.parse(localStorage.getItem('toshkaDailyStatus') || '{}');
            
            if (history.length === 0 && Object.keys(dailyStatus).length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞');
                return;
            }
            
            let report = '=== –û–¢–ß–ï–¢ –ü–û –ê–°–¢–ú–ï - –¢–û–®–ö–ê ===\n\n';
            report += `–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: ${new Date().toLocaleString('ru-RU')}\n\n`;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            report += '--- –°–¢–ê–¢–ò–°–¢–ò–ö–ê ---\n';
            report += `–í—Å–µ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–æ–≤: ${history.length}\n`;
            report += `–õ–µ–≥–∫–∏—Ö: ${history.filter(a => a.severity === 'light').length}\n`;
            report += `–°—Ä–µ–¥–Ω–∏—Ö: ${history.filter(a => a.severity === 'medium').length}\n`;
            report += `–¢—è–∂–µ–ª—ã—Ö: ${history.filter(a => a.severity === 'heavy').length}\n\n`;
            
            // –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–∏—Å—Ç—É–ø–æ–≤
            report += '--- –ò–°–¢–û–†–ò–Ø –ü–†–ò–°–¢–£–ü–û–í ---\n\n';
            history.reverse().forEach((attack, index) => {
                const date = new Date(attack.dateTime);
                report += `–ü—Ä–∏—Å—Ç—É–ø ${history.length - index}:\n`;
                report += `–î–∞—Ç–∞: ${date.toLocaleString('ru-RU')}\n`;
                report += `–¢—è–∂–µ—Å—Ç—å: ${attack.severity === 'light' ? '–õ–µ–≥–∫–∏–π' : attack.severity === 'medium' ? '–°—Ä–µ–¥–Ω–∏–π' : '–¢—è–∂–µ–ª—ã–π'}\n`;
                report += `–¢—Ä–∏–≥–≥–µ—Ä—ã: ${attack.triggers.join(', ')}\n`;
                report += `–°–∏–º–ø—Ç–æ–º—ã: ${attack.symptoms.join(', ')}\n`;
                report += `–õ–µ—á–µ–Ω–∏–µ:\n`;
                if (attack.medicines.salbutamol > 0) report += `  - –°–∞–ª—å–±—É—Ç–∞–º–æ–ª: ${attack.medicines.salbutamol} —Ä–∞–∑\n`;
                if (attack.medicines.budesonide > 0) report += `  - –ë—É–¥–µ—Å–æ–Ω–∏–¥: ${attack.medicines.budesonide} —Ä–∞–∑\n`;
                if (attack.medicines.prednisolone) report += `  - –ü—Ä–µ–¥–Ω–∏–∑–æ–ª–æ–Ω: –î–∞\n`;
                if (attack.medicines.hydrocortisone) report += `  - –ì–∏–¥—Ä–æ–∫–æ—Ä—Ç–∏–∑–æ–Ω: –î–∞\n`;
                if (attack.medicines.other) report += `  - –î—Ä—É–≥–æ–µ: ${attack.medicines.other}\n`;
                if (attack.recoveryTime) report += `–°—Ç–∞–ª–æ –ª–µ–≥—á–µ —á–µ—Ä–µ–∑: ${attack.recoveryTime} –º–∏–Ω—É—Ç\n`;
                if (attack.improvement) {
                    const improvementText = {
                        'fully': '–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—à–ª–æ',
                        'much': '–ù–∞–º–Ω–æ–≥–æ –ª–µ–≥—á–µ',
                        'little': '–ù–µ–º–Ω–æ–≥–æ –ª–µ–≥—á–µ',
                        'none': '–ù–µ –ø–æ–º–æ–≥–ª–æ'
                    };
                    report += `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${improvementText[attack.improvement]}\n`;
                }
                if (attack.comments) report += `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: ${attack.comments}\n`;
                report += '\n';
            });
            
            // –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `asthma-report-toshka-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
